# р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Юр╕ер╕Зр╣Др╕бр╣Ир╣Ар╕ер╣Ир╕Щ (MP3)

## р╕кр╕▓р╣Ар╕лр╕Хр╕╕р╕лр╕ер╕▒р╕Б
р╣Ар╕Юр╕ер╕Зр╣Др╕бр╣Ир╣Ар╕ер╣Ир╕Щр╣Ар╕Юр╕гр╕▓р╕░ **ESP32 р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н** р╕Бр╕▒р╕Ър╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М р╕лр╕гр╕╖р╕н **ESP32 р╣Др╕бр╣Ир╕гр╕нр╕Зр╕гр╕▒р╕Ъ MP3 decoder**

## р╕зр╕┤р╕Шр╕╡р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Log
р╣Ар╕бр╕╖р╣Ир╕нр╕гр╕▒р╕Щр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕б р╣Гр╕лр╣Йр╕Фр╕╣ log р╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Й:

```
тЪая╕П ESP32 not connected - waiting for connection on port 5555
тЪая╕П ESP32 not connected - audio will not play
тЪая╕П ESP32 not connected - audio chunks not being sent
```

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н ESP32
- ESP32 р╕Хр╣Йр╕нр╕Зр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ TCP port 5555
- р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕кр╕│р╣Ар╕гр╣Зр╕И р╕Ир╕░р╣Ар╕лр╣Зр╕Щ log:
```
тЬЕ ESP32 connected via TCP
ЁЯО╡ Audio output ready - ESP32 can now receive audio data
тЬЕ ESP32 connected - audio ready
```

## р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕В

### 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ ESP32
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ ESP32 р╕Бр╕│р╕ер╕▒р╕Зр╕гр╕▒р╕Щр╣Бр╕ер╕░р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ WiFi
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ ESP32 р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ IP address р╣Бр╕ер╕░ port 5555 р╕Вр╕нр╕Зр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
- **р╕кр╕│р╕Др╕▒р╕Н**: ESP32 р╕Хр╣Йр╕нр╕Зр╕бр╕╡ MP3 decoder library (р╣Ар╕Кр╣Ир╕Щ ESP32-audioI2S)

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Network
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ ESP32 р╣Бр╕ер╕░р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╣Ар╕Др╕гр╕╖р╕нр╕Вр╣Ир╕▓р╕вр╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Firewall р╕зр╣Ир╕▓р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Ър╕ер╣Зр╕нр╕Б port 5555

### 3. р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н
```bash
# р╕Чр╕Фр╕кр╕нр╕Ър╕Ир╕▓р╕Б ESP32 р╣Др╕Ыр╕вр╕▒р╕Зр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М
telnet [SERVER_IP] 5555
```

### 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ ESP32 Code
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ ESP32 code р╕бр╕╡р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н TCP р╣Др╕Ыр╕вр╕▒р╕Зр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╣Бр╕ер╕░р╕гр╕нр╕Зр╕гр╕▒р╕Ъ MP3:

```cpp
// р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З ESP32 code р╕кр╕│р╕лр╕гр╕▒р╕Ъ MP3
#include "AudioFileSourceTCPStream.h"
#include "AudioGeneratorMP3.h"
#include "AudioOutputI2S.h"

AudioGeneratorMP3 *mp3;
AudioFileSourceTCPStream *file;
AudioOutputI2S *out;

void setup() {
    // р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н WiFi р╣Бр╕ер╕░ TCP
    WiFiClient client;
    if (client.connect(serverIP, 5555)) {
        Serial.println("Connected to server");
        
        file = new AudioFileSourceTCPStream(client);
        out = new AudioOutputI2S();
        mp3 = new AudioGeneratorMP3();
        mp3->begin(file, out);
    }
}

void loop() {
    if (mp3->isRunning()) {
        mp3->loop();
    }
}
```

## р╕Бр╕▓р╕г Debug р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

### 1. р╣Ар╕Ыр╕┤р╕Ф Debug Mode
р╣Гр╕Щ `player/player.go` р╣Ар╕Ыр╕┤р╕Ф comment р╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Й:
```go
log.Printf("ЁЯУд Sending chunk [%d:%d] size: %d", offset-ChunkSize, offset, len(chunk))
```

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ MP3 Buffer
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕Яр╕ер╣М MP3 р╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Фр╕кр╕│р╣Ар╕гр╣Зр╕И:
```
ЁЯУж Loaded output/song1.mp3 (1234567 bytes)
```

### 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ WebSocket
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ WebSocket control р╕Чр╕│р╕Зр╕▓р╕Щ:
```
ЁЯОз Control WebSocket connected
ЁЯУе Command received: play
тЦ╢я╕П Start playing from offset: 0
```

### 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕бр╕Др╣М
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕бр╕Др╣Мр╕кр╣Ир╕З MP3 р╣Др╕Фр╣Й:
```
ЁЯМР Mic WebSocket connected
ЁЯУд Sending 256 bytes to ESP32
тЬЕ Successfully sent 256 bytes to ESP32
```

## р╕кр╕гр╕╕р╕Ы
р╕Ыр╕▒р╕Нр╕лр╕▓р╕лр╕ер╕▒р╕Бр╕Др╕╖р╕н ESP32 р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н р╕лр╕гр╕╖р╕н ESP32 р╣Др╕бр╣Ир╕бр╕╡ MP3 decoder library р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕Вр╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н ESP32 р╣Бр╕ер╕░р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З MP3 library р╕Бр╣Ир╕нр╕Щ 